input {
  lumberjack {
    codec => json
    port => "<%= scope.lookupvar("naturalislogforwarder::receiver::incomming_port") %>"
    ssl_certificate => "/etc/logstash/keys/lumberjack.crt"
    ssl_key => "/etc/logstash/keys/lumberjack.key"
  }

#### Redis Servers
<% scope.lookupvar("naturalislogforwarder::receiver::redis_servers").each do |rs| %>
  redis {
    host => '<% puts rs %>'
    key => 'logstash:redis'
    data_type => 'list'
    password => '<%= scope.lookupvar("naturalislogforwarder::receiver::redis_password") %>'
  }
<% end %>
### End of redis servers

}

<%= scope.lookupvar("naturalislogforwarder::receiver::logstash_filter") %>

output {
  #if "_grokparsefailure" not in [tags] {
    file {
      path => [ "/var/log/logstash/output.log" ]
  }
}
